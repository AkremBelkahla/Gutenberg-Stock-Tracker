(()=>{"use strict";var e,t={722:()=>{const e=window.wp.blocks,t=window.wp.i18n,a=window.React,r=window.wp.element,o=window.wp.blockEditor,s=window.wp.components;function l(e){return{AAPL:"https://upload.wikimedia.org/wikipedia/commons/f/fa/Apple_logo_black.svg",MSFT:"https://upload.wikimedia.org/wikipedia/commons/4/44/Microsoft_logo.svg",GOOGL:"https://upload.wikimedia.org/wikipedia/commons/2/2f/Google_2015_logo.svg",AMZN:"https://upload.wikimedia.org/wikipedia/commons/a/a9/Amazon_logo.svg",META:"https://upload.wikimedia.org/wikipedia/commons/7/7b/Meta_Platforms_Inc._logo.svg",NFLX:"https://upload.wikimedia.org/wikipedia/commons/0/08/Netflix_2015_logo.svg",NVDA:"https://upload.wikimedia.org/wikipedia/commons/2/21/Nvidia_logo.svg",TSLA:"https://upload.wikimedia.org/wikipedia/commons/e/e8/Tesla_logo.png"}[e]||"https://via.placeholder.com/30?text="+e}function c({symbol:e,data:t}){if(!t||!t.c)return(0,a.createElement)("div",{className:"stock-card"},(0,a.createElement)("div",{className:"stock-card-header"},(0,a.createElement)("div",{className:"stock-symbol-container"},(0,a.createElement)("img",{src:l(e),alt:`${e} logo`,className:"stock-logo"}),(0,a.createElement)("h4",{className:"stock-symbol"},e))),(0,a.createElement)("div",{className:"stock-card-body"},(0,a.createElement)("p",null,"Chargement...")));const r=t.c||0,o=t.h||t.c||0,s=t.l||t.c||0,c=t.dp||0,n=c>=0?"positive":"negative",i=l(e);return(0,a.createElement)("div",{className:"stock-card"},(0,a.createElement)("div",{className:"stock-card-header"},(0,a.createElement)("div",{className:"stock-symbol-container"},(0,a.createElement)("img",{src:i,alt:`${e} logo`,className:"stock-logo"}),(0,a.createElement)("h4",{className:"stock-symbol"},e)),(0,a.createElement)("span",{className:"stock-price"},"$",r.toFixed(2))),(0,a.createElement)("div",{className:"stock-card-body"},(0,a.createElement)("div",{className:`stock-change ${n}`},c>=0?"+":"",c.toFixed(2),"%"),(0,a.createElement)("div",{className:"stock-previous"},(0,a.createElement)("span",null,"Haut: $",o.toFixed(2)," Bas: $",s.toFixed(2)))))}function n({stockData:e,loading:r,lastUpdated:o,onRefresh:l}){return(0,a.createElement)("div",{className:"stock-tracker-grid"},(0,a.createElement)("div",{className:"stock-tracker-header"},(0,a.createElement)("h3",null,(0,t.__)("Données boursières","stock-tracker")),(0,a.createElement)("div",{className:"stock-tracker-controls"},o&&(0,a.createElement)("span",{className:"stock-tracker-last-updated"},(0,t.__)("Dernière mise à jour: ","stock-tracker"),o.toLocaleTimeString()),(0,a.createElement)(s.Button,{isPrimary:!0,onClick:l,isBusy:r,disabled:r},(0,t.__)("Actualiser","stock-tracker")))),(0,a.createElement)("div",{className:"stock-tracker-cards"},Object.entries(e).map((([e,t])=>(0,a.createElement)(c,{key:e,symbol:e,data:t})))))}function i({message:e,onRetry:r}){return(0,a.createElement)("div",{className:"stock-tracker-error"},(0,a.createElement)("p",{className:"stock-tracker-error-message"},e),r&&(0,a.createElement)(s.Button,{isPrimary:!0,onClick:r},(0,t.__)("Réessayer","stock-tracker")))}window.wp.apiFetch;const m=[{label:"Amazon (AMZN)",value:"AMZN"},{label:"Apple (AAPL)",value:"AAPL"},{label:"Google (GOOGL)",value:"GOOGL"},{label:"Meta (META)",value:"META"},{label:"Microsoft (MSFT)",value:"MSFT"},{label:"Netflix (NFLX)",value:"NFLX"},{label:"NVIDIA (NVDA)",value:"NVDA"},{label:"Tesla (TSLA)",value:"TSLA"}];(0,e.registerBlockType)("stock-tracker/market-data",{apiVersion:2,title:(0,t.__)("Stock Tracker","stock-tracker"),description:(0,t.__)("Affiche les données boursières en temps réel","stock-tracker"),category:"widgets",icon:"chart-line",supports:{html:!1,align:["wide","full"]},attributes:{stockSymbols:{type:"array",default:["AAPL","MSFT","GOOGL"]},apiKey:{type:"string",default:""},autoRefresh:{type:"boolean",default:!0},refreshInterval:{type:"number",default:5}},edit:function({attributes:e,setAttributes:l}){const{stockSymbols:c,apiKey:d,autoRefresh:u,refreshInterval:k}=e,[p,h]=(0,r.useState)({}),[v,g]=(0,r.useState)(!1),[f,b]=(0,r.useState)(null),[w,E]=(0,r.useState)(null),y=(0,o.useBlockProps)();(0,r.useEffect)((()=>{!d&&"undefined"!=typeof window&&window.stockTrackerData&&window.stockTrackerData.apiKey&&l({apiKey:window.stockTrackerData.apiKey})}),[]);const _=async()=>{if(d&&0!==c.length){g(!0),b(null);try{const e=await async function(e,t){if(!t)throw new Error("Clé API manquante");if(!e||!e.length)throw new Error("Aucun symbole d'action spécifié");try{const a={};return await Promise.all(e.map((async e=>{try{const r=await fetch(`https://finnhub.io/api/v1/quote?symbol=${e}&token=${t}`);if(!r.ok){if(429===r.status)throw new Error("Limite de taux API dépassée. Veuillez réessayer plus tard.");throw new Error(`Erreur API: ${r.status}`)}const o=await r.json();if(!o||o.error)throw new Error(o.error||"Données invalides reçues");o.h&&o.l||(console.warn(`Données incomplètes pour ${e}, ajout de valeurs par défaut`),o.h=o.h||o.c||0,o.l=o.l||o.c||0),a[e]=o}catch(t){console.error(`Erreur lors de la récupération des données pour ${e}:`,t),a[e]={error:t.message}}}))),a}catch(e){throw console.error("Erreur lors de la récupération des données boursières:",e),new Error("Impossible de récupérer les données boursières. Veuillez vérifier votre connexion et réessayer.")}}(c,d);h(e),E(new Date)}catch(e){b(e.message||(0,t.__)("Erreur lors de la récupération des données","stock-tracker"))}finally{g(!1)}}};return(0,r.useEffect)((()=>{_()}),[d,c]),(0,r.useEffect)((()=>{if(!u||!d||0===c.length)return;const e=setInterval((()=>{_()}),1e3*k);return()=>clearInterval(e)}),[u,k,d,c]),(0,a.createElement)(a.Fragment,null,(0,a.createElement)(o.InspectorControls,null,(0,a.createElement)(s.PanelBody,{title:(0,t.__)("Paramètres du Stock Tracker","stock-tracker")},(0,a.createElement)(s.TextControl,{label:(0,t.__)("Clé API Finnhub","stock-tracker"),value:d,onChange:e=>l({apiKey:e}),help:(0,t.__)("La clé API est chargée depuis le fichier .key à la racine du plugin. Modifiez ce fichier pour changer la clé.","stock-tracker")}),(0,a.createElement)(s.SelectControl,{multiple:!0,label:(0,t.__)("Symboles des actions (max 4)","stock-tracker"),value:c,options:m,onChange:e=>{e.length<=4&&l({stockSymbols:e})},help:c.length>=4?(0,t.__)("Nombre maximum de symboles atteint (4)","stock-tracker"):""}),(0,a.createElement)(s.ToggleControl,{label:(0,t.__)("Actualisation automatique","stock-tracker"),checked:u,onChange:e=>l({autoRefresh:e})}),u&&(0,a.createElement)(s.RangeControl,{label:(0,t.__)("Intervalle d'actualisation (secondes)","stock-tracker"),value:k,onChange:e=>l({refreshInterval:e}),min:5,max:60}))),(0,a.createElement)("div",{...y},d?0===c.length?(0,a.createElement)(s.Placeholder,{icon:"chart-line",label:(0,t.__)("Stock Tracker","stock-tracker"),instructions:(0,t.__)("Veuillez sélectionner au moins un symbole d'action dans les paramètres du bloc.","stock-tracker")}):f?(0,a.createElement)(i,{message:f,onRetry:_}):(0,a.createElement)(a.Fragment,null,(0,a.createElement)(n,{stockData:p,loading:v,lastUpdated:w,onRefresh:_})):(0,a.createElement)(s.Placeholder,{icon:"chart-line",label:(0,t.__)("Stock Tracker","stock-tracker"),instructions:(0,t.__)("Veuillez saisir votre clé API Finnhub dans les paramètres du bloc.","stock-tracker")})))},save:function({attributes:e}){const{stockSymbols:t,apiKey:r,autoRefresh:s,refreshInterval:l}=e,c=o.useBlockProps.save();return console.log("Stock Tracker Save: Attributs transmis",{stockSymbols:t,hasApiKey:!!r,autoRefresh:s,refreshInterval:l}),(0,a.createElement)("div",{...c,"data-symbols":t.join(","),"data-api-key":r||"","data-auto-refresh":s?"true":"false","data-refresh-interval":l},(0,a.createElement)("div",{className:"stock-tracker-grid"},(0,a.createElement)("div",{className:"stock-tracker-header"},(0,a.createElement)("h3",null,"Données boursières"),(0,a.createElement)("div",{className:"stock-tracker-controls"},(0,a.createElement)("span",{className:"stock-tracker-last-updated"}))),(0,a.createElement)("div",{className:"stock-tracker-cards"})))}})}},a={};function r(e){var o=a[e];if(void 0!==o)return o.exports;var s=a[e]={exports:{}};return t[e](s,s.exports,r),s.exports}r.m=t,e=[],r.O=(t,a,o,s)=>{if(!a){var l=1/0;for(m=0;m<e.length;m++){for(var[a,o,s]=e[m],c=!0,n=0;n<a.length;n++)(!1&s||l>=s)&&Object.keys(r.O).every((e=>r.O[e](a[n])))?a.splice(n--,1):(c=!1,s<l&&(l=s));if(c){e.splice(m--,1);var i=o();void 0!==i&&(t=i)}}return t}s=s||0;for(var m=e.length;m>0&&e[m-1][2]>s;m--)e[m]=e[m-1];e[m]=[a,o,s]},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={57:0,350:0};r.O.j=t=>0===e[t];var t=(t,a)=>{var o,s,[l,c,n]=a,i=0;if(l.some((t=>0!==e[t]))){for(o in c)r.o(c,o)&&(r.m[o]=c[o]);if(n)var m=n(r)}for(t&&t(a);i<l.length;i++)s=l[i],r.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return r.O(m)},a=globalThis.webpackChunkstock_tracker=globalThis.webpackChunkstock_tracker||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})();var o=r.O(void 0,[350],(()=>r(722)));o=r.O(o)})();