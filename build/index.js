(()=>{"use strict";var e,t={722:()=>{const e=window.wp.blocks,t=window.wp.i18n,r=window.React,a=window.wp.element,s=window.wp.blockEditor,o=window.wp.components;function c({symbol:e,data:a}){const{c:s,pc:o,d:c,dp:n}=a,l=c>=0;return(0,r.createElement)("div",{className:"stock-card"},(0,r.createElement)("div",{className:"stock-card-header"},(0,r.createElement)("h4",{className:"stock-symbol"},e),(0,r.createElement)("span",{className:"stock-price"},"$",s.toFixed(2))),(0,r.createElement)("div",{className:"stock-card-body"},(0,r.createElement)("div",{className:"stock-change "+(l?"positive":"negative")},(0,r.createElement)("span",{className:"stock-change-arrow"},l?"↑":"↓"),(0,r.createElement)("span",{className:"stock-change-value"},"$",Math.abs(c).toFixed(2)," (",Math.abs(n).toFixed(2),"%)")),(0,r.createElement)("div",{className:"stock-previous"},(0,t.__)("Précédent: ","stock-tracker"),(0,r.createElement)("span",{className:"stock-previous-value"},"$",o.toFixed(2)))))}function n({stockData:e,loading:a,lastUpdated:s,onRefresh:n}){return(0,r.createElement)("div",{className:"stock-tracker-grid"},(0,r.createElement)("div",{className:"stock-tracker-header"},(0,r.createElement)("h3",null,(0,t.__)("Données boursières","stock-tracker")),(0,r.createElement)("div",{className:"stock-tracker-controls"},s&&(0,r.createElement)("span",{className:"stock-tracker-last-updated"},(0,t.__)("Dernière mise à jour: ","stock-tracker"),s.toLocaleTimeString()),(0,r.createElement)(o.Button,{isPrimary:!0,onClick:n,isBusy:a,disabled:a},(0,t.__)("Actualiser","stock-tracker")))),(0,r.createElement)("div",{className:"stock-tracker-cards"},Object.entries(e).map((([e,t])=>(0,r.createElement)(c,{key:e,symbol:e,data:t})))))}function l({message:e,onRetry:a}){return(0,r.createElement)("div",{className:"stock-tracker-error"},(0,r.createElement)("p",{className:"stock-tracker-error-message"},e),a&&(0,r.createElement)(o.Button,{isPrimary:!0,onClick:a},(0,t.__)("Réessayer","stock-tracker")))}window.wp.apiFetch;const i=[{label:"Apple (AAPL)",value:"AAPL"},{label:"Microsoft (MSFT)",value:"MSFT"},{label:"Google (GOOGL)",value:"GOOGL"},{label:"Amazon (AMZN)",value:"AMZN"},{label:"NVIDIA (NVDA)",value:"NVDA"},{label:"Tesla (TSLA)",value:"TSLA"},{label:"Meta (META)",value:"META"},{label:"Netflix (NFLX)",value:"NFLX"}];(0,e.registerBlockType)("stock-tracker/market-data",{apiVersion:2,title:(0,t.__)("Stock Tracker","stock-tracker"),description:(0,t.__)("Affiche les données boursières en temps réel","stock-tracker"),category:"widgets",icon:"chart-line",supports:{html:!1,align:["wide","full"]},attributes:{stockSymbols:{type:"array",default:["AAPL","MSFT","GOOGL"]},apiKey:{type:"string",default:"d05rgchr01qgqsu940tgd05rgchr01qgqsu940u0"},autoRefresh:{type:"boolean",default:!0},refreshInterval:{type:"number",default:5}},edit:function({attributes:e,setAttributes:c}){const{stockSymbols:u,apiKey:m,autoRefresh:d,refreshInterval:k}=e,[p,h]=(0,a.useState)({}),[v,b]=(0,a.useState)(!1),[f,E]=(0,a.useState)(null),[y,g]=(0,a.useState)(null),w=(0,s.useBlockProps)(),_=async()=>{if(m&&0!==u.length){b(!0),E(null);try{const e=await async function(e,t){if(!t)throw new Error("Clé API manquante");if(!e||!e.length)throw new Error("Aucun symbole d'action spécifié");try{const r={};return await Promise.all(e.map((async e=>{try{const a=await fetch(`https://finnhub.io/api/v1/quote?symbol=${e}&token=${t}`);if(!a.ok){if(429===a.status)throw new Error("Limite de taux API dépassée. Veuillez réessayer plus tard.");throw new Error(`Erreur API: ${a.status}`)}const s=await a.json();if(!s||s.error)throw new Error(s.error||"Données invalides reçues");r[e]=s}catch(t){console.error(`Erreur lors de la récupération des données pour ${e}:`,t),r[e]={error:t.message}}}))),r}catch(e){throw console.error("Erreur lors de la récupération des données boursières:",e),new Error("Impossible de récupérer les données boursières. Veuillez vérifier votre connexion et réessayer.")}}(u,m);h(e),g(new Date)}catch(e){E(e.message||(0,t.__)("Erreur lors de la récupération des données","stock-tracker"))}finally{b(!1)}}};return(0,a.useEffect)((()=>{_()}),[m,u]),(0,a.useEffect)((()=>{if(!d||!m||0===u.length)return;const e=setInterval((()=>{_()}),1e3*k);return()=>clearInterval(e)}),[d,k,m,u]),(0,r.createElement)(r.Fragment,null,(0,r.createElement)(s.InspectorControls,null,(0,r.createElement)(o.PanelBody,{title:(0,t.__)("Paramètres du Stock Tracker","stock-tracker")},(0,r.createElement)(o.TextControl,{label:(0,t.__)("Clé API Finnhub","stock-tracker"),value:m,onChange:e=>c({apiKey:e}),help:(0,t.__)("Clé API déjà configurée. Modifiez uniquement si nécessaire.","stock-tracker")}),(0,r.createElement)(o.SelectControl,{multiple:!0,label:(0,t.__)("Symboles des actions","stock-tracker"),value:u,options:i,onChange:e=>c({stockSymbols:e})}),(0,r.createElement)(o.ToggleControl,{label:(0,t.__)("Actualisation automatique","stock-tracker"),checked:d,onChange:e=>c({autoRefresh:e})}),d&&(0,r.createElement)(o.RangeControl,{label:(0,t.__)("Intervalle d'actualisation (secondes)","stock-tracker"),value:k,onChange:e=>c({refreshInterval:e}),min:5,max:60}))),(0,r.createElement)("div",{...w},m?0===u.length?(0,r.createElement)(o.Placeholder,{icon:"chart-line",label:(0,t.__)("Stock Tracker","stock-tracker"),instructions:(0,t.__)("Veuillez sélectionner au moins un symbole d'action dans les paramètres du bloc.","stock-tracker")}):f?(0,r.createElement)(l,{message:f,onRetry:_}):(0,r.createElement)(r.Fragment,null,(0,r.createElement)(n,{stockData:p,loading:v,lastUpdated:y,onRefresh:_})):(0,r.createElement)(o.Placeholder,{icon:"chart-line",label:(0,t.__)("Stock Tracker","stock-tracker"),instructions:(0,t.__)("Veuillez saisir votre clé API Finnhub dans les paramètres du bloc.","stock-tracker")})))},save:function({attributes:e}){const{stockSymbols:t,apiKey:a,autoRefresh:o,refreshInterval:c}=e,n=s.useBlockProps.save();return(0,r.createElement)("div",{...n,"data-symbols":t.join(","),"data-api-key":a,"data-auto-refresh":o.toString(),"data-refresh-interval":c},(0,r.createElement)("div",{className:"stock-tracker-container"}))}})}},r={};function a(e){var s=r[e];if(void 0!==s)return s.exports;var o=r[e]={exports:{}};return t[e](o,o.exports,a),o.exports}a.m=t,e=[],a.O=(t,r,s,o)=>{if(!r){var c=1/0;for(u=0;u<e.length;u++){for(var[r,s,o]=e[u],n=!0,l=0;l<r.length;l++)(!1&o||c>=o)&&Object.keys(a.O).every((e=>a.O[e](r[l])))?r.splice(l--,1):(n=!1,o<c&&(c=o));if(n){e.splice(u--,1);var i=s();void 0!==i&&(t=i)}}return t}o=o||0;for(var u=e.length;u>0&&e[u-1][2]>o;u--)e[u]=e[u-1];e[u]=[r,s,o]},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={57:0,350:0};a.O.j=t=>0===e[t];var t=(t,r)=>{var s,o,[c,n,l]=r,i=0;if(c.some((t=>0!==e[t]))){for(s in n)a.o(n,s)&&(a.m[s]=n[s]);if(l)var u=l(a)}for(t&&t(r);i<c.length;i++)o=c[i],a.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return a.O(u)},r=globalThis.webpackChunkstock_tracker=globalThis.webpackChunkstock_tracker||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var s=a.O(void 0,[350],(()=>a(722)));s=a.O(s)})();