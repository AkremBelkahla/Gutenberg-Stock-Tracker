(()=>{var e,t={74:()=>{document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll(".wp-block-stock-tracker-market-data").forEach((e=>{const t=(e.dataset.symbols?.split(",")||[]).sort(),r=e.dataset.apiKey,a="true"===e.dataset.autoRefresh,s=parseInt(e.dataset.refreshInterval,10)||5;if(!t.length||!r)return void(e.innerHTML='\n                <div class="stock-tracker-error">\n                    <p class="stock-tracker-error-message">Configuration incomplète du bloc Stock Tracker</p>\n                </div>\n            ');e.innerHTML='\n            <div class="stock-tracker-grid">\n                <div class="stock-tracker-header">\n                    <h3>Données boursières en temps réel</h3>\n                    <div class="stock-tracker-controls">\n                        <span class="stock-tracker-last-updated"></span>\n                    </div>\n                </div>\n                <div class="stock-tracker-cards"></div>\n            </div>\n        ';const n=e.querySelector(".stock-tracker-cards"),o=e.querySelector(".stock-tracker-last-updated");async function c(){try{const e={};await Promise.all(t.map((async t=>{try{const a=await fetch(`https://finnhub.io/api/v1/quote?symbol=${t}&token=${r}`);if(!a.ok)throw new Error(`Erreur API: ${a.status}`);const s=await a.json();e[t]=s}catch(r){console.error(`Erreur pour ${t}:`,r),e[t]={error:r.message}}}))),function(e){const r=new Date;o.textContent=`Dernière mise à jour: ${r.toLocaleTimeString()}`;const a={};t.forEach((t=>{a[t]=e[t]})),n.hasChildNodes()||Object.keys(a).forEach((e=>{const t=document.createElement("div");t.id=`stock-card-${e}`,t.className="stock-card",n.appendChild(t)})),Object.keys(a).forEach((e=>{const t=n.querySelector(`#stock-card-${e}`);if(!t)return;const r=a[e];if(!r)return void(t.innerHTML=`\n                        <div class="stock-card-header">\n                            <h4 class="stock-symbol">${e}</h4>\n                        </div>\n                        <div class="stock-card-body">\n                            <p>Chargement...</p>\n                        </div>\n                    `);if(r.error)return void(t.innerHTML=`\n                        <div class="stock-card-header">\n                            <h4 class="stock-symbol">${e}</h4>\n                        </div>\n                        <div class="stock-card-body">\n                            <p class="stock-tracker-error-message">Erreur: ${r.error}</p>\n                        </div>\n                    `);const s=r.dp||0,o=s>=0?"positive":"negative";t.innerHTML=`\n                    <div class="stock-card-header">\n                        <h4 class="stock-symbol">${e}</h4>\n                        <span class="stock-price">$${r.c.toFixed(2)}</span>\n                    </div>\n                    <div class="stock-card-body">\n                        <div class="stock-change ${o}">\n                            ${s>=0?"+":""}${s.toFixed(2)}%\n                        </div>\n                        <div class="stock-previous">\n                            <span>H: $${r.h.toFixed(2)}</span>\n                            <span>L: $${r.l.toFixed(2)}</span>\n                            <span class="${r.d>=0?"positive":"negative"}">\n                                ${s>=0?"+":""}$${Math.abs(s).toFixed(2)}\n                            </span>\n                        </div>\n                    </div>\n                `}))}(e)}catch(e){console.error("Erreur de récupération des données:",e),n.innerHTML="<p>Erreur lors de la récupération des données</p>"}}c(),a&&setInterval(c,1e3*s)}))}))},722:(e,t,r)=>{"use strict";const a=window.wp.blocks,s=window.wp.i18n,n=window.React,o=window.wp.element,c=window.wp.blockEditor,l=window.wp.components;function i({symbol:e,data:t}){const{c:r,pc:a,d:o,dp:c}=t,l=o>=0;return(0,n.createElement)("div",{className:"stock-card"},(0,n.createElement)("div",{className:"stock-card-header"},(0,n.createElement)("h4",{className:"stock-symbol"},e),(0,n.createElement)("span",{className:"stock-price"},"$",r.toFixed(2))),(0,n.createElement)("div",{className:"stock-card-body"},(0,n.createElement)("div",{className:"stock-change "+(l?"positive":"negative")},(0,n.createElement)("span",{className:"stock-change-arrow"},l?"↑":"↓"),(0,n.createElement)("span",{className:"stock-change-value"},"$",Math.abs(o).toFixed(2)," (",Math.abs(c).toFixed(2),"%)")),(0,n.createElement)("div",{className:"stock-previous"},(0,s.__)("Précédent: ","stock-tracker"),(0,n.createElement)("span",{className:"stock-previous-value"},"$",a.toFixed(2)))))}function d({stockData:e,loading:t,lastUpdated:r,onRefresh:a}){return(0,n.createElement)("div",{className:"stock-tracker-grid"},(0,n.createElement)("div",{className:"stock-tracker-header"},(0,n.createElement)("h3",null,(0,s.__)("Données boursières","stock-tracker")),(0,n.createElement)("div",{className:"stock-tracker-controls"},r&&(0,n.createElement)("span",{className:"stock-tracker-last-updated"},(0,s.__)("Dernière mise à jour: ","stock-tracker"),r.toLocaleTimeString()),(0,n.createElement)(l.Button,{isPrimary:!0,onClick:a,isBusy:t,disabled:t},(0,s.__)("Actualiser","stock-tracker")))),(0,n.createElement)("div",{className:"stock-tracker-cards"},Object.entries(e).map((([e,t])=>(0,n.createElement)(i,{key:e,symbol:e,data:t})))))}function u({message:e,onRetry:t}){return(0,n.createElement)("div",{className:"stock-tracker-error"},(0,n.createElement)("p",{className:"stock-tracker-error-message"},e),t&&(0,n.createElement)(l.Button,{isPrimary:!0,onClick:t},(0,s.__)("Réessayer","stock-tracker")))}window.wp.apiFetch;const k=[{label:"Amazon (AMZN)",value:"AMZN"},{label:"Apple (AAPL)",value:"AAPL"},{label:"Google (GOOGL)",value:"GOOGL"},{label:"Meta (META)",value:"META"},{label:"Microsoft (MSFT)",value:"MSFT"},{label:"Netflix (NFLX)",value:"NFLX"},{label:"NVIDIA (NVDA)",value:"NVDA"},{label:"Tesla (TSLA)",value:"TSLA"}];r(74),(0,a.registerBlockType)("stock-tracker/market-data",{apiVersion:2,title:(0,s.__)("Stock Tracker","stock-tracker"),description:(0,s.__)("Affiche les données boursières en temps réel","stock-tracker"),category:"widgets",icon:"chart-line",supports:{html:!1,align:["wide","full"]},attributes:{stockSymbols:{type:"array",default:["AAPL","MSFT","GOOGL"]},apiKey:{type:"string",default:""},autoRefresh:{type:"boolean",default:!0},refreshInterval:{type:"number",default:5}},edit:function({attributes:e,setAttributes:t}){const{stockSymbols:r,apiKey:a,autoRefresh:i,refreshInterval:m}=e,[p,h]=(0,o.useState)({}),[v,f]=(0,o.useState)(!1),[b,y]=(0,o.useState)(null),[E,w]=(0,o.useState)(null),g=(0,c.useBlockProps)();(0,o.useEffect)((()=>{!a&&"undefined"!=typeof window&&window.stockTrackerData&&window.stockTrackerData.apiKey&&t({apiKey:window.stockTrackerData.apiKey})}),[]);const _=async()=>{if(a&&0!==r.length){f(!0),y(null);try{const e=await async function(e,t){if(!t)throw new Error("Clé API manquante");if(!e||!e.length)throw new Error("Aucun symbole d'action spécifié");try{const r={};return await Promise.all(e.map((async e=>{try{const a=await fetch(`https://finnhub.io/api/v1/quote?symbol=${e}&token=${t}`);if(!a.ok){if(429===a.status)throw new Error("Limite de taux API dépassée. Veuillez réessayer plus tard.");throw new Error(`Erreur API: ${a.status}`)}const s=await a.json();if(!s||s.error)throw new Error(s.error||"Données invalides reçues");r[e]=s}catch(t){console.error(`Erreur lors de la récupération des données pour ${e}:`,t),r[e]={error:t.message}}}))),r}catch(e){throw console.error("Erreur lors de la récupération des données boursières:",e),new Error("Impossible de récupérer les données boursières. Veuillez vérifier votre connexion et réessayer.")}}(r,a);h(e),w(new Date)}catch(e){y(e.message||(0,s.__)("Erreur lors de la récupération des données","stock-tracker"))}finally{f(!1)}}};return(0,o.useEffect)((()=>{_()}),[a,r]),(0,o.useEffect)((()=>{if(!i||!a||0===r.length)return;const e=setInterval((()=>{_()}),1e3*m);return()=>clearInterval(e)}),[i,m,a,r]),(0,n.createElement)(n.Fragment,null,(0,n.createElement)(c.InspectorControls,null,(0,n.createElement)(l.PanelBody,{title:(0,s.__)("Paramètres du Stock Tracker","stock-tracker")},(0,n.createElement)(l.TextControl,{label:(0,s.__)("Clé API Finnhub","stock-tracker"),value:a,onChange:e=>t({apiKey:e}),help:(0,s.__)("La clé API est chargée depuis le fichier .key à la racine du plugin. Modifiez ce fichier pour changer la clé.","stock-tracker")}),(0,n.createElement)(l.SelectControl,{multiple:!0,label:(0,s.__)("Symboles des actions (max 4)","stock-tracker"),value:r,options:k,onChange:e=>{e.length<=4&&t({stockSymbols:e})},help:r.length>=4?(0,s.__)("Nombre maximum de symboles atteint (4)","stock-tracker"):""}),(0,n.createElement)(l.ToggleControl,{label:(0,s.__)("Actualisation automatique","stock-tracker"),checked:i,onChange:e=>t({autoRefresh:e})}),i&&(0,n.createElement)(l.RangeControl,{label:(0,s.__)("Intervalle d'actualisation (secondes)","stock-tracker"),value:m,onChange:e=>t({refreshInterval:e}),min:5,max:60}))),(0,n.createElement)("div",{...g},a?0===r.length?(0,n.createElement)(l.Placeholder,{icon:"chart-line",label:(0,s.__)("Stock Tracker","stock-tracker"),instructions:(0,s.__)("Veuillez sélectionner au moins un symbole d'action dans les paramètres du bloc.","stock-tracker")}):b?(0,n.createElement)(u,{message:b,onRetry:_}):(0,n.createElement)(n.Fragment,null,(0,n.createElement)(d,{stockData:p,loading:v,lastUpdated:E,onRefresh:_})):(0,n.createElement)(l.Placeholder,{icon:"chart-line",label:(0,s.__)("Stock Tracker","stock-tracker"),instructions:(0,s.__)("Veuillez saisir votre clé API Finnhub dans les paramètres du bloc.","stock-tracker")})))},save:function({attributes:e}){const{stockSymbols:t,apiKey:r,autoRefresh:a,refreshInterval:s}=e,o=c.useBlockProps.save();return(0,n.createElement)("div",{...o,"data-symbols":t.join(","),"data-api-key":r,"data-auto-refresh":a.toString(),"data-refresh-interval":s},(0,n.createElement)("div",{className:"stock-tracker-container"}))}})}},r={};function a(e){var s=r[e];if(void 0!==s)return s.exports;var n=r[e]={exports:{}};return t[e](n,n.exports,a),n.exports}a.m=t,e=[],a.O=(t,r,s,n)=>{if(!r){var o=1/0;for(d=0;d<e.length;d++){for(var[r,s,n]=e[d],c=!0,l=0;l<r.length;l++)(!1&n||o>=n)&&Object.keys(a.O).every((e=>a.O[e](r[l])))?r.splice(l--,1):(c=!1,n<o&&(o=n));if(c){e.splice(d--,1);var i=s();void 0!==i&&(t=i)}}return t}n=n||0;for(var d=e.length;d>0&&e[d-1][2]>n;d--)e[d]=e[d-1];e[d]=[r,s,n]},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={57:0,350:0};a.O.j=t=>0===e[t];var t=(t,r)=>{var s,n,[o,c,l]=r,i=0;if(o.some((t=>0!==e[t]))){for(s in c)a.o(c,s)&&(a.m[s]=c[s]);if(l)var d=l(a)}for(t&&t(r);i<o.length;i++)n=o[i],a.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return a.O(d)},r=globalThis.webpackChunkstock_tracker=globalThis.webpackChunkstock_tracker||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var s=a.O(void 0,[350],(()=>a(722)));s=a.O(s)})();