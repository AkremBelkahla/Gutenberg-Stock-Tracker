(()=>{var e,t={74:()=>{document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll(".wp-block-stock-tracker-market-data").forEach((e=>{const t=(e.dataset.symbols?.split(",")||[]).sort(),r=window.stockTrackerData?.apiKey||e.dataset.apiKey,a="true"===e.dataset.autoRefresh,s=parseInt(e.dataset.refreshInterval,10)||5;if(console.log("Stock Tracker: Initialisation",{symbols:t,apiKey:r?"présente":"absente",autoRefresh:a,refreshInterval:s}),!t.length||!r){const r=t.length?"Clé API manquante":"Aucun symbole sélectionné";return void(e.innerHTML=`\n                <div class="stock-tracker-error">\n                    <p class="stock-tracker-error-message">Configuration incomplète du bloc Stock Tracker: ${r}</p>\n                </div>\n            `)}const o=e.querySelector(".stock-tracker-cards"),c=e.querySelector(".stock-tracker-last-updated");async function n(){console.log("Stock Tracker: Début de la récupération des données");try{const e={};console.log("Stock Tracker: Symboles à récupérer:",t),await Promise.all(t.map((async t=>{try{const a=await fetch(`https://finnhub.io/api/v1/quote?symbol=${t}&token=${r}`);if(!a.ok)throw new Error(`Erreur API: ${a.status}`);const s=await a.json();e[t]=s}catch(r){console.error(`Erreur pour ${t}:`,r),e[t]={error:r.message}}}))),function(e){console.log("Stock Tracker: Début mise à jour affichage",e);const r=new Date;c.textContent=`Dernière mise à jour: ${r.toLocaleTimeString()}`;const a={};t.forEach((t=>{a[t]=e[t]})),console.log("Stock Tracker: stockGrid présent ?",!!o),o.hasChildNodes()||Object.keys(a).forEach((e=>{const t=document.createElement("div");t.id=`stock-card-${e}`,t.className="stock-card",o.appendChild(t)})),Object.keys(a).forEach((e=>{const t=o.querySelector(`#stock-card-${e}`);if(!t)return;const r=a[e];if(!r)return void(t.innerHTML=`\n                        <div class="stock-card-header">\n                            <h4 class="stock-symbol">${e}</h4>\n                        </div>\n                        <div class="stock-card-body">\n                            <p>Chargement...</p>\n                        </div>\n                    `);if(r.error)return void(t.innerHTML=`\n                        <div class="stock-card-header">\n                            <h4 class="stock-symbol">${e}</h4>\n                        </div>\n                        <div class="stock-card-body">\n                            <p class="stock-tracker-error-message">Erreur: ${r.error}</p>\n                        </div>\n                    `);const s=r.dp||0,c=s>=0?"positive":"negative";t.innerHTML=`\n                    <div class="stock-card-header">\n                        <h4 class="stock-symbol">${e}</h4>\n                        <span class="stock-price">$${r.c.toFixed(2)}</span>\n                    </div>\n                    <div class="stock-card-body">\n                        <div class="stock-change ${c}">\n                            ${s>=0?"+":""}${s.toFixed(2)}%\n                        </div>\n                        <div class="stock-previous">\n                            <span>H: $${r.h.toFixed(2)}</span>\n                            <span>L: $${r.l.toFixed(2)}</span>\n                            <span class="${r.d>=0?"positive":"negative"}">\n                                ${s>=0?"+":""}$${Math.abs(s).toFixed(2)}\n                            </span>\n                        </div>\n                    </div>\n                `}))}(e)}catch(e){console.error("Erreur de récupération des données:",e),o.innerHTML="<p>Erreur lors de la récupération des données</p>"}}n(),a&&setInterval(n,1e3*s)}))}))},722:(e,t,r)=>{"use strict";const a=window.wp.blocks,s=window.wp.i18n,o=window.React,c=window.wp.element,n=window.wp.blockEditor,l=window.wp.components;function i({symbol:e,data:t}){const{c:r,pc:a,d:c,dp:n}=t,l=c>=0;return(0,o.createElement)("div",{className:"stock-card"},(0,o.createElement)("div",{className:"stock-card-header"},(0,o.createElement)("h4",{className:"stock-symbol"},e),(0,o.createElement)("span",{className:"stock-price"},"$",r.toFixed(2))),(0,o.createElement)("div",{className:"stock-card-body"},(0,o.createElement)("div",{className:"stock-change "+(l?"positive":"negative")},(0,o.createElement)("span",{className:"stock-change-arrow"},l?"↑":"↓"),(0,o.createElement)("span",{className:"stock-change-value"},"$",Math.abs(c).toFixed(2)," (",Math.abs(n).toFixed(2),"%)")),(0,o.createElement)("div",{className:"stock-previous"},(0,s.__)("Précédent: ","stock-tracker"),(0,o.createElement)("span",{className:"stock-previous-value"},"$",a.toFixed(2)))))}function d({stockData:e,loading:t,lastUpdated:r,onRefresh:a}){return(0,o.createElement)("div",{className:"stock-tracker-grid"},(0,o.createElement)("div",{className:"stock-tracker-header"},(0,o.createElement)("h3",null,(0,s.__)("Données boursières","stock-tracker")),(0,o.createElement)("div",{className:"stock-tracker-controls"},r&&(0,o.createElement)("span",{className:"stock-tracker-last-updated"},(0,s.__)("Dernière mise à jour: ","stock-tracker"),r.toLocaleTimeString()),(0,o.createElement)(l.Button,{isPrimary:!0,onClick:a,isBusy:t,disabled:t},(0,s.__)("Actualiser","stock-tracker")))),(0,o.createElement)("div",{className:"stock-tracker-cards"},Object.entries(e).map((([e,t])=>(0,o.createElement)(i,{key:e,symbol:e,data:t})))))}function u({message:e,onRetry:t}){return(0,o.createElement)("div",{className:"stock-tracker-error"},(0,o.createElement)("p",{className:"stock-tracker-error-message"},e),t&&(0,o.createElement)(l.Button,{isPrimary:!0,onClick:t},(0,s.__)("Réessayer","stock-tracker")))}window.wp.apiFetch;const k=[{label:"Amazon (AMZN)",value:"AMZN"},{label:"Apple (AAPL)",value:"AAPL"},{label:"Google (GOOGL)",value:"GOOGL"},{label:"Meta (META)",value:"META"},{label:"Microsoft (MSFT)",value:"MSFT"},{label:"Netflix (NFLX)",value:"NFLX"},{label:"NVIDIA (NVDA)",value:"NVDA"},{label:"Tesla (TSLA)",value:"TSLA"}];r(74),(0,a.registerBlockType)("stock-tracker/market-data",{apiVersion:2,title:(0,s.__)("Stock Tracker","stock-tracker"),description:(0,s.__)("Affiche les données boursières en temps réel","stock-tracker"),category:"widgets",icon:"chart-line",supports:{html:!1,align:["wide","full"]},attributes:{stockSymbols:{type:"array",default:["AAPL","MSFT","GOOGL"]},apiKey:{type:"string",default:""},autoRefresh:{type:"boolean",default:!0},refreshInterval:{type:"number",default:5}},edit:function({attributes:e,setAttributes:t}){const{stockSymbols:r,apiKey:a,autoRefresh:i,refreshInterval:m}=e,[p,h]=(0,c.useState)({}),[v,f]=(0,c.useState)(!1),[b,y]=(0,c.useState)(null),[E,g]=(0,c.useState)(null),w=(0,n.useBlockProps)();(0,c.useEffect)((()=>{!a&&"undefined"!=typeof window&&window.stockTrackerData&&window.stockTrackerData.apiKey&&t({apiKey:window.stockTrackerData.apiKey})}),[]);const _=async()=>{if(a&&0!==r.length){f(!0),y(null);try{const e=await async function(e,t){if(!t)throw new Error("Clé API manquante");if(!e||!e.length)throw new Error("Aucun symbole d'action spécifié");try{const r={};return await Promise.all(e.map((async e=>{try{const a=await fetch(`https://finnhub.io/api/v1/quote?symbol=${e}&token=${t}`);if(!a.ok){if(429===a.status)throw new Error("Limite de taux API dépassée. Veuillez réessayer plus tard.");throw new Error(`Erreur API: ${a.status}`)}const s=await a.json();if(!s||s.error)throw new Error(s.error||"Données invalides reçues");r[e]=s}catch(t){console.error(`Erreur lors de la récupération des données pour ${e}:`,t),r[e]={error:t.message}}}))),r}catch(e){throw console.error("Erreur lors de la récupération des données boursières:",e),new Error("Impossible de récupérer les données boursières. Veuillez vérifier votre connexion et réessayer.")}}(r,a);h(e),g(new Date)}catch(e){y(e.message||(0,s.__)("Erreur lors de la récupération des données","stock-tracker"))}finally{f(!1)}}};return(0,c.useEffect)((()=>{_()}),[a,r]),(0,c.useEffect)((()=>{if(!i||!a||0===r.length)return;const e=setInterval((()=>{_()}),1e3*m);return()=>clearInterval(e)}),[i,m,a,r]),(0,o.createElement)(o.Fragment,null,(0,o.createElement)(n.InspectorControls,null,(0,o.createElement)(l.PanelBody,{title:(0,s.__)("Paramètres du Stock Tracker","stock-tracker")},(0,o.createElement)(l.TextControl,{label:(0,s.__)("Clé API Finnhub","stock-tracker"),value:a,onChange:e=>t({apiKey:e}),help:(0,s.__)("La clé API est chargée depuis le fichier .key à la racine du plugin. Modifiez ce fichier pour changer la clé.","stock-tracker")}),(0,o.createElement)(l.SelectControl,{multiple:!0,label:(0,s.__)("Symboles des actions (max 4)","stock-tracker"),value:r,options:k,onChange:e=>{e.length<=4&&t({stockSymbols:e})},help:r.length>=4?(0,s.__)("Nombre maximum de symboles atteint (4)","stock-tracker"):""}),(0,o.createElement)(l.ToggleControl,{label:(0,s.__)("Actualisation automatique","stock-tracker"),checked:i,onChange:e=>t({autoRefresh:e})}),i&&(0,o.createElement)(l.RangeControl,{label:(0,s.__)("Intervalle d'actualisation (secondes)","stock-tracker"),value:m,onChange:e=>t({refreshInterval:e}),min:5,max:60}))),(0,o.createElement)("div",{...w},a?0===r.length?(0,o.createElement)(l.Placeholder,{icon:"chart-line",label:(0,s.__)("Stock Tracker","stock-tracker"),instructions:(0,s.__)("Veuillez sélectionner au moins un symbole d'action dans les paramètres du bloc.","stock-tracker")}):b?(0,o.createElement)(u,{message:b,onRetry:_}):(0,o.createElement)(o.Fragment,null,(0,o.createElement)(d,{stockData:p,loading:v,lastUpdated:E,onRefresh:_})):(0,o.createElement)(l.Placeholder,{icon:"chart-line",label:(0,s.__)("Stock Tracker","stock-tracker"),instructions:(0,s.__)("Veuillez saisir votre clé API Finnhub dans les paramètres du bloc.","stock-tracker")})))},save:function({attributes:e}){const{stockSymbols:t,apiKey:r,autoRefresh:a,refreshInterval:s}=e,c=n.useBlockProps.save();return console.log("Stock Tracker Save: Attributs transmis",{stockSymbols:t,hasApiKey:!!r,autoRefresh:a,refreshInterval:s}),(0,o.createElement)("div",{...c,"data-symbols":t.join(","),"data-api-key":r||"","data-auto-refresh":a.toString(),"data-refresh-interval":s},(0,o.createElement)("div",{className:"stock-tracker-grid"},(0,o.createElement)("div",{className:"stock-tracker-header"},(0,o.createElement)("h3",null,"Données boursières en temps réel"),(0,o.createElement)("div",{className:"stock-tracker-controls"},(0,o.createElement)("span",{className:"stock-tracker-last-updated"}))),(0,o.createElement)("div",{className:"stock-tracker-cards"})))}})}},r={};function a(e){var s=r[e];if(void 0!==s)return s.exports;var o=r[e]={exports:{}};return t[e](o,o.exports,a),o.exports}a.m=t,e=[],a.O=(t,r,s,o)=>{if(!r){var c=1/0;for(d=0;d<e.length;d++){for(var[r,s,o]=e[d],n=!0,l=0;l<r.length;l++)(!1&o||c>=o)&&Object.keys(a.O).every((e=>a.O[e](r[l])))?r.splice(l--,1):(n=!1,o<c&&(c=o));if(n){e.splice(d--,1);var i=s();void 0!==i&&(t=i)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[r,s,o]},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={57:0,350:0};a.O.j=t=>0===e[t];var t=(t,r)=>{var s,o,[c,n,l]=r,i=0;if(c.some((t=>0!==e[t]))){for(s in n)a.o(n,s)&&(a.m[s]=n[s]);if(l)var d=l(a)}for(t&&t(r);i<c.length;i++)o=c[i],a.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return a.O(d)},r=globalThis.webpackChunkstock_tracker=globalThis.webpackChunkstock_tracker||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var s=a.O(void 0,[350],(()=>a(722)));s=a.O(s)})();