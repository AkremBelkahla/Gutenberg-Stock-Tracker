(()=>{"use strict";var e,t={722:()=>{const e=window.wp.blocks,t=window.wp.i18n,r=window.React,a=window.wp.element,s=window.wp.blockEditor,c=window.wp.components;function o({symbol:e,data:a}){const{c:s,pc:c,d:o,dp:l}=a,n=o>=0;return(0,r.createElement)("div",{className:"stock-card"},(0,r.createElement)("div",{className:"stock-card-header"},(0,r.createElement)("h4",{className:"stock-symbol"},e),(0,r.createElement)("span",{className:"stock-price"},"$",s.toFixed(2))),(0,r.createElement)("div",{className:"stock-card-body"},(0,r.createElement)("div",{className:"stock-change "+(n?"positive":"negative")},(0,r.createElement)("span",{className:"stock-change-arrow"},n?"↑":"↓"),(0,r.createElement)("span",{className:"stock-change-value"},"$",Math.abs(o).toFixed(2)," (",Math.abs(l).toFixed(2),"%)")),(0,r.createElement)("div",{className:"stock-previous"},(0,t.__)("Précédent: ","stock-tracker"),(0,r.createElement)("span",{className:"stock-previous-value"},"$",c.toFixed(2)))))}function l({stockData:e,loading:a,lastUpdated:s,onRefresh:l}){return(0,r.createElement)("div",{className:"stock-tracker-grid"},(0,r.createElement)("div",{className:"stock-tracker-header"},(0,r.createElement)("h3",null,(0,t.__)("Données boursières","stock-tracker")),(0,r.createElement)("div",{className:"stock-tracker-controls"},s&&(0,r.createElement)("span",{className:"stock-tracker-last-updated"},(0,t.__)("Dernière mise à jour: ","stock-tracker"),s.toLocaleTimeString()),(0,r.createElement)(c.Button,{isPrimary:!0,onClick:l,isBusy:a,disabled:a},(0,t.__)("Actualiser","stock-tracker")))),(0,r.createElement)("div",{className:"stock-tracker-cards"},Object.entries(e).map((([e,t])=>(0,r.createElement)(o,{key:e,symbol:e,data:t})))))}function n({message:e,onRetry:a}){return(0,r.createElement)("div",{className:"stock-tracker-error"},(0,r.createElement)("p",{className:"stock-tracker-error-message"},e),a&&(0,r.createElement)(c.Button,{isPrimary:!0,onClick:a},(0,t.__)("Réessayer","stock-tracker")))}window.wp.apiFetch;const i=[{label:"Amazon (AMZN)",value:"AMZN"},{label:"Apple (AAPL)",value:"AAPL"},{label:"Google (GOOGL)",value:"GOOGL"},{label:"Meta (META)",value:"META"},{label:"Microsoft (MSFT)",value:"MSFT"},{label:"Netflix (NFLX)",value:"NFLX"},{label:"NVIDIA (NVDA)",value:"NVDA"},{label:"Tesla (TSLA)",value:"TSLA"}];(0,e.registerBlockType)("stock-tracker/market-data",{apiVersion:2,title:(0,t.__)("Stock Tracker","stock-tracker"),description:(0,t.__)("Affiche les données boursières en temps réel","stock-tracker"),category:"widgets",icon:"chart-line",supports:{html:!1,align:["wide","full"]},attributes:{stockSymbols:{type:"array",default:["AAPL","MSFT","GOOGL"]},apiKey:{type:"string",default:""},autoRefresh:{type:"boolean",default:!0},refreshInterval:{type:"number",default:5}},edit:function({attributes:e,setAttributes:o}){const{stockSymbols:u,apiKey:k,autoRefresh:m,refreshInterval:d}=e,[p,h]=(0,a.useState)({}),[v,f]=(0,a.useState)(!1),[b,E]=(0,a.useState)(null),[y,w]=(0,a.useState)(null),g=(0,s.useBlockProps)();(0,a.useEffect)((()=>{!k&&"undefined"!=typeof window&&window.stockTrackerData&&window.stockTrackerData.apiKey&&o({apiKey:window.stockTrackerData.apiKey})}),[]);const _=async()=>{if(k&&0!==u.length){f(!0),E(null);try{const e=await async function(e,t){if(!t)throw new Error("Clé API manquante");if(!e||!e.length)throw new Error("Aucun symbole d'action spécifié");try{const r={};return await Promise.all(e.map((async e=>{try{const a=await fetch(`https://finnhub.io/api/v1/quote?symbol=${e}&token=${t}`);if(!a.ok){if(429===a.status)throw new Error("Limite de taux API dépassée. Veuillez réessayer plus tard.");throw new Error(`Erreur API: ${a.status}`)}const s=await a.json();if(!s||s.error)throw new Error(s.error||"Données invalides reçues");r[e]=s}catch(t){console.error(`Erreur lors de la récupération des données pour ${e}:`,t),r[e]={error:t.message}}}))),r}catch(e){throw console.error("Erreur lors de la récupération des données boursières:",e),new Error("Impossible de récupérer les données boursières. Veuillez vérifier votre connexion et réessayer.")}}(u,k);h(e),w(new Date)}catch(e){E(e.message||(0,t.__)("Erreur lors de la récupération des données","stock-tracker"))}finally{f(!1)}}};return(0,a.useEffect)((()=>{_()}),[k,u]),(0,a.useEffect)((()=>{if(!m||!k||0===u.length)return;const e=setInterval((()=>{_()}),1e3*d);return()=>clearInterval(e)}),[m,d,k,u]),(0,r.createElement)(r.Fragment,null,(0,r.createElement)(s.InspectorControls,null,(0,r.createElement)(c.PanelBody,{title:(0,t.__)("Paramètres du Stock Tracker","stock-tracker")},(0,r.createElement)(c.TextControl,{label:(0,t.__)("Clé API Finnhub","stock-tracker"),value:k,onChange:e=>o({apiKey:e}),help:(0,t.__)("La clé API est chargée depuis le fichier .key à la racine du plugin. Modifiez ce fichier pour changer la clé.","stock-tracker")}),(0,r.createElement)(c.SelectControl,{multiple:!0,label:(0,t.__)("Symboles des actions (max 4)","stock-tracker"),value:u,options:i,onChange:e=>{e.length<=4&&o({stockSymbols:e})},help:u.length>=4?(0,t.__)("Nombre maximum de symboles atteint (4)","stock-tracker"):""}),(0,r.createElement)(c.ToggleControl,{label:(0,t.__)("Actualisation automatique","stock-tracker"),checked:m,onChange:e=>o({autoRefresh:e})}),m&&(0,r.createElement)(c.RangeControl,{label:(0,t.__)("Intervalle d'actualisation (secondes)","stock-tracker"),value:d,onChange:e=>o({refreshInterval:e}),min:5,max:60}))),(0,r.createElement)("div",{...g},k?0===u.length?(0,r.createElement)(c.Placeholder,{icon:"chart-line",label:(0,t.__)("Stock Tracker","stock-tracker"),instructions:(0,t.__)("Veuillez sélectionner au moins un symbole d'action dans les paramètres du bloc.","stock-tracker")}):b?(0,r.createElement)(n,{message:b,onRetry:_}):(0,r.createElement)(r.Fragment,null,(0,r.createElement)(l,{stockData:p,loading:v,lastUpdated:y,onRefresh:_})):(0,r.createElement)(c.Placeholder,{icon:"chart-line",label:(0,t.__)("Stock Tracker","stock-tracker"),instructions:(0,t.__)("Veuillez saisir votre clé API Finnhub dans les paramètres du bloc.","stock-tracker")})))},save:function({attributes:e}){const{stockSymbols:t,apiKey:a,autoRefresh:c,refreshInterval:o}=e,l=s.useBlockProps.save();return console.log("Stock Tracker Save: Attributs transmis",{stockSymbols:t,hasApiKey:!!a,autoRefresh:c,refreshInterval:o}),(0,r.createElement)("div",{...l,"data-symbols":t.join(","),"data-api-key":a||"","data-auto-refresh":c.toString(),"data-refresh-interval":o},(0,r.createElement)("div",{className:"stock-tracker-grid"},(0,r.createElement)("div",{className:"stock-tracker-header"},(0,r.createElement)("h3",null,"Données boursières en temps réel"),(0,r.createElement)("div",{className:"stock-tracker-controls"},(0,r.createElement)("span",{className:"stock-tracker-last-updated"}))),(0,r.createElement)("div",{className:"stock-tracker-cards"})))}})}},r={};function a(e){var s=r[e];if(void 0!==s)return s.exports;var c=r[e]={exports:{}};return t[e](c,c.exports,a),c.exports}a.m=t,e=[],a.O=(t,r,s,c)=>{if(!r){var o=1/0;for(u=0;u<e.length;u++){for(var[r,s,c]=e[u],l=!0,n=0;n<r.length;n++)(!1&c||o>=c)&&Object.keys(a.O).every((e=>a.O[e](r[n])))?r.splice(n--,1):(l=!1,c<o&&(o=c));if(l){e.splice(u--,1);var i=s();void 0!==i&&(t=i)}}return t}c=c||0;for(var u=e.length;u>0&&e[u-1][2]>c;u--)e[u]=e[u-1];e[u]=[r,s,c]},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={57:0,350:0};a.O.j=t=>0===e[t];var t=(t,r)=>{var s,c,[o,l,n]=r,i=0;if(o.some((t=>0!==e[t]))){for(s in l)a.o(l,s)&&(a.m[s]=l[s]);if(n)var u=n(a)}for(t&&t(r);i<o.length;i++)c=o[i],a.o(e,c)&&e[c]&&e[c][0](),e[c]=0;return a.O(u)},r=globalThis.webpackChunkstock_tracker=globalThis.webpackChunkstock_tracker||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var s=a.O(void 0,[350],(()=>a(722)));s=a.O(s)})();